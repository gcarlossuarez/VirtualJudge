<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ICPC Judge - C#</title>
  <style>
    body { font-family: sans-serif; margin: 2em; }
    textarea, pre { width: 100%; min-height: 100px; font-family: monospace; }
    .result { background: #f5f5f5; padding: 1em; border-radius: 6px; white-space: pre-wrap; }
    .ok { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
    .warn { color: orange; font-style: italic; }
  </style>
</head>
<body>
  <h1>Mini Judge - C#</h1>

  <form id="form">
    <label>Archivo de código (.cs o .zip):</label><br>
    <input type="file" name="code" required><br><br>

    <label>Entrada estándar (stdin):</label><br>
    <textarea name="stdin" placeholder="ej: 7 35"></textarea><br><br>

    <label>Límite de tiempo (segundos):</label><br>
    <input type="number" name="timeLimit" value="6" min="1" max="30"><br><br>

    <button type="submit">Enviar</button>
  </form>

  <h2>Resultado</h2>
  <div id="output" class="result">Esperando envío...</div>

  <script>
    const form = document.getElementById('form');
    const output = document.getElementById('output');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      output.innerHTML = "<em>Ejecutando...</em>";

      const data = new FormData(form);

      try {
        const res = await fetch('http://localhost:5000/compile-run', {
          method: 'POST',
          body: data
        });

        if (!res.ok) {
          output.innerHTML = "<span class='error'>Error HTTP: " + res.status + "</span>";
          return;
        }

        const json = await res.json();

        let html = "";
        html += `<p><strong>Compilación:</strong> <span class='${json.buildStatus.includes("ok") ? "ok" : "error"}'>${json.buildStatus}</span></p>`;
        html += `<p><strong>Ejecución:</strong> <span class='${json.runStatus.includes("ok") ? "ok" : "error"}'>${json.runStatus}</span></p>`;
        if (json.time) html += `<p><strong>Tiempo:</strong> ${json.time}</p>`;
        if (json.memKB) html += `<p><strong>Memoria:</strong> ${json.memKB} KB</p>`;

        /*
        if (json.buildStatus !== "ok") {
          html += `<h3>Errores de compilación</h3><pre>${json.buildLog}</pre>`;
        } else if (json.runStatus !== "ok") {
          html += `<h3>Errores de ejecución</h3><pre>${json.runLog}</pre>`;
        } else {
          // ✅ build ok y run ok → mostrar salida limpia
          let cleanOutput = json.runLog
            .replace(/TIME=.*\n?/g, "")
            .replace(/MEM=.*\n?/g, "")
            .trim();

          html += `<h3>Salida del programa</h3><pre>${cleanOutput}</pre>`;

          // Mostrar warnings si existen en buildLog
          if (/warning/i.test(json.buildLog)) {
            html += `<h3 class="warn">Avisos de compilación</h3><pre>${json.buildLog}</pre>`;
          }
        }
        */
        if (json.buildStatus.includes("error")) {
          html += `<h3>Errores de compilación</h3><pre>${json.buildLog}</pre>`;
        } else if (json.runStatus.includes("error")) {
          html += `<h3>Errores de ejecución</h3><pre>${json.runLog}</pre>`;
        } else {
          // ✅ build ok y run ok → mostrar salida limpia
          let cleanOutput = json.runLog
            .replace(/TIME=.*\n?/g, "")
            .replace(/MEM=.*\n?/g, "")
            .trim();

          html += `<h3>Salida del programa</h3><pre>${cleanOutput}</pre>`;

          // Mostrar warnings si existen
          if (/warning/i.test(json.buildLog)) {
            html += `<h3 class="warn">Avisos de compilación</h3><pre>${json.buildLog}</pre>`;
          }
        }


        output.innerHTML = html;
      } catch (err) {
        output.innerHTML = "<span class='error'>Error de red: " + err + "</span>";
      }
    });
  </script>
</body>
</html>

